<!--
    BED Assignment CA2
    -   Name: Lee Quan Jun Ervin
    -   Admin No: 2104005
    -   Class: DISM/FT/2B/21
    -   Filename: client/public/admin.html
    -   Description: Admin panel of SP AIR (only available to sysadmins)
-->

<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <!-- Favicon Icon -->
        <link rel="icon" type="image/x-icon" href="./images/favicon.png">
        <!-- Link with Bootstrap 5.0 -->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
            integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
            crossorigin="anonymous"></script>
        <!-- Link with jQuery library -->
        <script src="https://code.jquery.com/jquery-3.3.1.min.js"
            integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
        <!-- Link with Popper.js -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
            integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
            crossorigin="anonymous"></script>
        <!-- Link with Axios library -->
        <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
        <!-- Link CSS file styles -->
        <link rel="stylesheet" href="./css/admin.css">
        <link rel="stylesheet" href="./css/global.css">
        <!-- Link with Google Font -->
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Work+Sans&display=swap" rel="stylesheet">
        <!-- Link with FontAwesome for icons -->
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta2/css/all.min.css"
            integrity="sha512-YWzhKL2whUzgiheMoBFwW8CKV4qpHQAEuvilg9FAn5VJUDwKZZxkJNuGM4XkWuk94WCrrwslk8yWNGmY1EduTA=="
            crossorigin="anonymous" referrerpolicy="no-referrer" />
        <title>Admin Panel | SP AIR </title>
    </head>
    <body>
        <!-- Navigation Bar -->
        <nav class="navbar navbar-expand-md navbar-light fixed-top" aria-label="SP AIR Navigation Bar">
            <div class="container-fluid">
                <a class="navbar-brand" href="/"><img src="./images/favicon.png" alt="SP AIR Logo" id="spairlogo"></a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#sp-air-navigation-bar"
                    aria-controls="sp-air-navigation-bar" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
            
                <div class="collapse navbar-collapse" id="sp-air-navigation-bar">
                    <div class="navbar-nav me-auto mb-2 mb-md-0">
                        <h3><strong>SP AIR Admin Panel</strong></h3>
                    </div>
                    <a class="btn btn-primary" id="view-profile" style="margin:0px 5px;" href="/profile">View Profile<i class="fa-regular fa-user icon" style="padding-right:5px;"></i></a>
                    <a class="btn btn-primary" id="exit-admin" style="margin:0px 5px;" href="/">Exit Admin Panel<i class="fa-solid fa-right-from-bracket" style="padding-right:5px;"></i></a>
                </div>
            </div>
        </nav>

        <!-- User Tables -->
        <div class="container" id="user-table" style="padding-top:150px;">
            <h1>Account List</h1>
            <hr>
            <table class="table table-light table-striped table-borderless">
                <thead>
                    <tr>
                        <th scope="col">#</th>
                        <th scope="col">Username</th>
                        <th scope="col">Email</th>
                        <th scope="col">Contact Number</th>
                        <th scope="col">Role</th>
                        <th scope="col">Account Created At</th>
                    </tr>
                </thead>
                <tbody id="user-table-body">
                </tbody>
            </table>
        </div>

        <!-- Airport Tables -->
        <div class="container" id="airport-table">
            <h1>Airports List &#9992;</h1>
            <hr>
            <table class="table table-light table-striped">
                <thead>
                    <tr>
                        <th scope="col">#</th>
                        <th scope="col">Airport/City Name</th>
                        <th scope="col">Country</th>
                        <th scope="col">Description</th>
                        <th scope="col">IATA Code</th>
                    </tr>
                </thead>
                <tbody id="airport-table-body">
                </tbody>
            </table>

            <!-- Button trigger modals -->
            <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#add-new-airport">
                Add Airport/City
            </button>

            <button type="button" class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#delete-airport-modal">
                Delete Airport/City
            </button>
            
            <!-- Modal for New Airport-->
            <div class="modal fade" id="add-new-airport" tabindex="-1" aria-labelledby="add-new-airport" aria-hidden="true" data-bs-keyboard="false" data-bs-backdrop="static">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">Add New Airport</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <form class="needs-validation" id="add-new-airport-form" novalidate>
                                <div class="mb-3">
                                    <label id="add-airport-name" for="add-airport-name" class="col-form-label">City/Airport Name</label>
                                    <input type="text" class="form-control" id="airport-name" required>
                                    <div class="invalid-feedback">
                                        Please enter this field!
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label id="add-airport-country" for="add-airport-country" class="col-form-label">Country</label>
                                    <input type="text" class="form-control" id="airport-country" required>
                                    <div class="invalid-feedback">
                                        Please enter this field!
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label id="add-airport-description" for="add-airport-description" class="col-form-label">Description</label>
                                    <input type="text" class="form-control" id="airport-description" required>
                                    <div class="invalid-feedback">
                                        Please enter this field!
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label id="add-airport-iata" for="add-airport-iata" class="col-form-label">IATA Code</label>
                                    <input type="text" class="form-control" id="airport-iata" required>
                                    <div class="invalid-feedback">
                                        Please enter this field!
                                    </div>
                                </div>
                                <div>
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                                    <button type="submit" class="btn btn-primary" id="add-airport-button">Add Airport</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Modal for Delete Airport -->
            <div class="modal fade" id="delete-airport-modal" tabindex="-1" aria-labelledby="delete-airport-modal" aria-hidden="true"
                data-bs-keyboard="false" data-bs-backdrop="static">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">Delete An Airport</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <form class="needs-validation" id="delete-airport-form" novalidate>
                                <div class="mb-3">
                                    <label id="delete-airport" for="delete-airport" class="col-form-label">Select an airport to delete:</label>
                                    <select class="form-select" id="airport-options-3" required>
                                        <option selected value="">...</option>
                                    </select>
                                    <div class="invalid-feedback">
                                        Please enter this field!
                                    </div>
                                </div>
                                <div>
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                                    <button type="submit" class="btn btn-primary" id="delete-airport-button">Delete Airport</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Flight Table -->
        <div class="container" id="flight-table">
            <h1>Flights List &#9992;</h1>
            <hr>
            <div class="table-responsive">
                <table class="table table-light table-striped table-borderless">
                    <thead>
                        <tr>
                            <th scope="col">#</th>
                            <th scope="col">Flight Code</th>
                            <th scope="col">Aircraft</th>
                            <th scope="col">Origin Airport</th>
                            <th scope="col">Origin IATA</th>
                            <th scope="col">Destination Airport</th>
                            <th scope="col">Destination IATA</th>
                            <th scope="col">Embark Date</th>
                            <th scope="col">Flight Time</th>
                            <th scope="col">Price</th>
                            <th scope="col">Image</th>
                            <th scope="col">Timestamp</th>
                            <th scope="col">Link</th>
                        </tr>
                    </thead>
                    <tbody id="flight-table-body">
                    </tbody>
                </table>
            </div>

            <!-- Button trigger modal -->
            <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#add-new-flight">
                Add New Flight
            </button>

            <button type="button" class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#delete-flight-modal">
                Delete A Flight
            </button>

            <!-- Modal -->
            <div class="modal fade" id="add-new-flight" tabindex="-1" aria-labelledby="add-new-flight" aria-hidden="true"
                data-bs-keyboard="false" data-bs-backdrop="static">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">Add New Flight</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <form class="needs-validation" id="add-new-flight-form" novalidate>
                                <div class="mb-3">
                                    <label id="add-flight-code" for="add-flight-code" class="col-form-label">Flight Code</label>
                                    <input type="text" class="form-control" id="flight-code" required>
                                    <div class="invalid-feedback">
                                        Please enter this field!
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label id="add-flight-aircraft" for="add-flight-aircraft" class="col-form-label">Aircraft</label>
                                    <input type="text" class="form-control" id="flight-aircraft" required>
                                    <div class="invalid-feedback">
                                        Please enter this field!
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label id="add-origin-airport" for="add-origin-airport" class="col-form-label">Origin Airport</label>
                                    <select id="airport-options-1" class="form-select" aria-label="Origin Airport" required>
                                        <option selected value="">Please select...</option>
                                    </select>
                                    <div class="invalid-feedback">
                                        Please select an airport!
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label id="add-destination-airport" for="add-destination-airport" class="col-form-label">Destination Airport</label>
                                    <select id="airport-options-2" class="form-select" aria-label="Destination Airport" required>
                                        <option selected value="">Please select...</option>
                                    </select>
                                    <div class="invalid-feedback">
                                        Please select an airport!
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label id="enter-embark-date" for="enter-embark-date" class="col-form-label">Embark Date</label>
                                    <input id="embark-date" class="form-control" type="datetime-local" required>
                                    <div class="invalid-feedback">
                                        Please select a date!
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label id="add-flight-time" for="add-flight-time" class="col-form-label">Flight Time</label>
                                    <div class="row">
                                        <div class="col">
                                            <label class="col-form-label">Hours</label>
                                            <input type="number" min="0" class="form-control" id="flight-time-hours" required>
                                            <div class="invalid-feedback">
                                                Please enter this field!
                                            </div>
                                        </div>
                                        <div class="col">
                                            <label class="col-form-label">Minutes</label>
                                            <input type="number" min="0" max="59" class="form-control" id="flight-time-minutes" required>
                                            <div class="invalid-feedback">
                                                Please enter this field!
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label id="add-flight-price" for="add-flight-price" class="col-form-label">Price</label>
                                    <input type="number" min="0" step="0.01" class="form-control" id="flight-price" required>
                                    <div class="invalid-feedback">
                                        Please input a valid price!
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label id="add-flight-image" for="add-flight-image" class="col-form-label">Upload Product Image</label>
                                    <input class="form-control form-control-sm" id="upload-flight-image" type="file" accept="image/*" required>
                                    <div class="invalid-feedback">
                                        Please upload an image!
                                    </div>
                                    <br>
                                </div>
                                <div>
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                                    <button type="submit" class="btn btn-primary" id="add-flight-button">Add Flight</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Modal for Delete Flight -->
            <div class="modal fade" id="delete-flight-modal" tabindex="-1" aria-labelledby="delete-flight-modal"
                aria-hidden="true" data-bs-keyboard="false" data-bs-backdrop="static">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">Delete A Flight</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <form class="needs-validation" id="delete-flight-form" novalidate>
                                <div class="mb-3">
                                    <label id="delete-flight" for="delete-flight" class="col-form-label">Select a flight to
                                        delete:</label>
                                    <select class="form-select" id="flight-options" required>
                                        <option selected value="">...</option>
                                    </select>
                                    <div class="invalid-feedback">
                                        Please enter this field!
                                    </div>
                                </div>
                                <div>
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                                    <button type="submit" class="btn btn-primary" id="delete-flight-button">Delete Flight</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Promotion Table -->
        <div class="container pb-5" id="promotion-table">
            <h1>Promotions &#9992;</h1>
            <hr>
            <div class="table-responsive">
                <table class="table table-light table-striped table-borderless">
                    <thead>
                        <tr>
                            <th scope="col">#</th>
                            <th scope="col">Flight</th>
                            <th scope="col">Start Date</th>
                            <th scope="col">End Date</th>
                            <th scope="col">Discount (%)</th>
                        </tr>
                    </thead>
                    <tbody id="promotion-table-body">
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Button trigger modal -->
        <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#add-new-promotion">
            Add New Promotion
        </button>
        <button type="button" class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#delete-promotion-modal">
            Delete A Promotion
        </button>

        <!-- Modal -->
        <div class="modal fade" id="add-new-promotion" tabindex="-1" aria-labelledby="add-new-promotion" aria-hidden="true"
            data-bs-keyboard="false" data-bs-backdrop="static">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Add New Promotion</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <form class="needs-validation" id="add-new-promotion-form" novalidate>
                            <div class="mb-3">
                                <label id="add-promotion-flight" for="add-promotion-flight" class="col-form-label">Promotion For Flight</label>
                                <select class="form-select" id="promotion-flight" aria-label="promotion-flight" required>
                                    <option selected value="">Please select...</option>
                                </select>
                                <div class="invalid-feedback">
                                    Please enter this field!
                                </div>
                            </div>
                            <div class="mb-3">
                                <label id="add-promotion-start" for="add-promotion-start" class="col-form-label">Promotion Start Date</label>
                                <input type="date" class="form-control" id="promotion-start-date" required>
                                <div class="invalid-feedback">
                                    Please complete this field!
                                </div>
                            </div>
                            <div class="mb-3">
                                <label id="add-promotion-end" for="add-promotion-end" class="col-form-label">Promotion End Date</label>
                                <input type="date" class="form-control" id="promotion-end-date" required>
                                <div class="invalid-feedback">
                                    Please enter this field!
                                </div>
                            </div>
                            <div class="mb-3">
                                <label id="add-promotion-discount" for="add-promotion-discount" class="col-form-label">Discount (%)</label>
                                <input type="number" min="0" class="form-control" id="promotion-discount" required>
                                <div class="invalid-feedback">
                                    Please enter this field!
                                </div>
                            </div>
                            <div>
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                                <button type="submit" class="btn btn-primary" id="add-promtion-button">Add Promotion</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Modal for Delete Promotion -->
        <div class="modal fade" id="delete-promotion-modal" tabindex="-1" aria-labelledby="delete-promotion-modal" aria-hidden="true"
            data-bs-keyboard="false" data-bs-backdrop="static">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Delete A Promotion</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <form class="needs-validation" id="delete-promotion-form" novalidate>
                            <div class="mb-3">
                                <label id="delete-promotion" for="delete-promotion" class="col-form-label">Select a promotion to
                                    delete:</label>
                                <select class="form-select" id="promotion-options" required>
                                    <option selected value="">...</option>
                                </select>
                                <div class="invalid-feedback">
                                    Please enter this field!
                                </div>
                            </div>
                            <div>
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                                <button type="submit" class="btn btn-primary">Delete Promotion</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <div id="toast"></div>
        <script>
            // Get date's date
            var dateToday = new Date()
        </script>
        <!-- Function to redirect user to flight page with flightid local storage -->
        <script>
            function flightRedirect(flightid) {
                window.localStorage.setItem("redirect_flightid", flightid)
            }
        </script>

        <!-- Redirect user to login page if not logged in -->
        <script>
            // Get token from the local storage
            const token = localStorage.getItem("token")
            const loggedInUserID = parseInt(localStorage.getItem("loggedInUserID"))

            // Redirect if guest user clicks on profile
            // Check if token or logged in userid is defined
            if (token === null || isNaN(loggedInUserID)) {
                window.location.assign("/login")
            }
        </script>

        <!-- Function to redirect user to flight page with flightid local storage -->
        <script>
            function flightRedirect(flightid) {
                window.localStorage.setItem("redirect_flightid", flightid)
            }
        </script>

        <!-- Form Validation -->
        <script>
            (function () {
                    'use strict'
                    var forms = document.querySelectorAll('.needs-validation')
                    Array.prototype.slice.call(forms)
                        .forEach(function (form) {
                            form.addEventListener('submit', function (event) {
                                if (!form.checkValidity()) {
                                    event.preventDefault()
                                    event.stopPropagation()
                                }
                                form.classList.add('was-validated')
                            }, false)
                        })
                })()
        </script>

        <!-- Add New Form Submissions -->
        <script>
            // Base URL for backend server
            const baseURL = "http://localhost:8081"

            // When New Airport Form is submitted
            $("#add-new-airport-form").submit((event) => {
                // Prevent the page from loading
                event.preventDefault()

                // Get submitted airport information
                const airportName = $("#airport-name").val()
                const airportCountry = $("#airport-country").val()
                const airportDescription = $("#airport-description").val()
                const airportIata = $("#airport-iata").val()

                if (airportName !== '' || airportCountry !== '' || airportDescription !== '' || airportIata !== '') {
                    const requestBody = {
                        name: airportName,
                        country: airportCountry,
                        description: airportDescription,
                        iata: airportIata
                    }
    
                    // Axios POST method to create new airport in airport database 
                    axios.post(`${baseURL}/airport/`, requestBody, {
                        headers: {
                            "Authorization": "Bearer " + token
                        }
                    })
                        .then((response) => {
                            // Reload the page to update changes
                            window.location.reload()
                        })
    
                        .catch((error) => {
                            console.log(error)
                            console.log(error.response.data)
                            if (error.response.status === 422) {
                                alert("Duplicate Entry Detected! Please ensure that your inputs unqiue from exisitng airports!")
                            }
                        })
                }

            })

            // When New Flight Form is submitted
            $("#add-new-flight-form").submit((event) => {
                // Prevent page from loading
                event.preventDefault()

                // Get submitted flight information from 
                const flightCode = $("#flight-code").val()
                const aircraft = $("#flight-aircraft").val()
                const originAirportId = $("#airport-options-1").val()
                const destinationAirportId = $("#airport-options-2").val()
                var embarkDate = $("#embark-date").val()
                var flightTimeHours = $("#flight-time-hours").val()
                var flightTimeMinutes = $("#flight-time-minutes").val()
                var embarkDate2 = new Date(embarkDate)

                // Validate dates to ensure cannot create new flight before today's date
                if (embarkDate2 < dateToday) {
                    alert("You cannot create a new flight before today!")
                }

                // Append 0 to single digit minutes
                if (flightTimeMinutes < 10) {
                    flightTimeMinutes = "0" + flightTimeMinutes
                } if (flightTimeHours < 10) {
                    flightTimeHours = "0" + flightTimeHours
                }

                var flightTime = `${flightTimeHours}:${flightTimeMinutes}` 

                const price = $("#flight-price").val()

                const flightImage = document.getElementById("upload-flight-image").files[0]
                if (flightCode !== '' || aircraft !== '' || originAirportId !== '' || destinationAirportId !== '' || embarkDate !== '' || flightTime !== '' || price !== '') {
                    if (flightImage === undefined) {
                        flightImage = null
                    }

                    var formData = new FormData()
                    formData.append("flightCode", flightCode)
                    formData.append("aircraft", aircraft)
                    formData.append("originAirport", originAirportId)
                    formData.append("destinationAirport", destinationAirportId)
                    formData.append("embarkDate", embarkDate)
                    formData.append("travelTime", flightTime)
                    formData.append("price", price)
                    formData.append("flight_pic_url", flightImage)

                    // Axios POST request to add a new flight to the flight database
                    axios.post(`${baseURL}/flight`, formData, {
                        headers: {
                            "Content-Type": "multipart/form-data",
                            "Authorization": "Bearer " + token
                        }
                    })
                        .then((response) => {
                            window.location.reload()
                        })

                        .catch((error) => {
                            if (error.response.status === 422) {
                                alert("[422] Duplicate flight or airports found!")
                            }
                            console.log(error.response.data)
                        })
                }
            })

            // When new promotion form is submitted
            $("#add-new-promotion-form").submit((event) => {
                // Prevent page from loading
                event.preventDefault()

                // Get submitted promotion form
                const promotionFlight = $("#promotion-flight").val()
                const promotionStartDate = $("#promotion-start-date").val()
                const promotionEndDate = $("#promotion-end-date").val()
                var promotionDiscount = $("#promotion-discount").val()

                if (promotionDiscount >= 100) {
                    alert("Promotion cannot be more than 100%! There is no such thing as free flights! >:(")
                } else {
                    // Convert promotion discount into decimal form
                    promotionDiscount /= 100

                    // Create request body
                    const requestBody = {
                        startDate: promotionStartDate,
                        endDate: promotionEndDate,
                        discount: promotionDiscount
                    }

                    const flightid = promotionFlight
                    // Axios POST method to create a new promotion in the promotion database
                    axios.post(`${baseURL}/promotion/${flightid}`, requestBody, {
                        headers: {
                            "Authorization": "Bearer " + token
                        }
                    })
                        .then((response) => {
                            window.location.reload()
                        }) 
                        
                        .catch((error) => {
                            if (error.response.status === 500) {
                                alert("Invalid dates received! Ensure that start date is before the end date!")
                            }
                            console.log(error.response.data)
                        })
                }
            })

            // When delete airport form is submitted
            $("#delete-airport-form").submit((event) => {
                // Prevent page from loading
                event.preventDefault()

                // Get airport to delete
                const airportid = $("#airport-options-3").val()
                
                // Axios DELETE method to delete airprot by airportid
                axios.delete(`${baseURL}/airport/${airportid}`)
                    .then((response) => {
                        window.location.reload()
                    })

                    .catch((error) => {
                        console.log(error.response.data)
                    })
            })

            // When delete flight form is submitted
            $("#delete-flight-form").submit((event) => {
                // Prevent page from loading
                event.preventDefault()

                // Get flightid to delete
                const flightid = $("#flight-options").val()

                // Axios DELETE method to delete flight by flightid
                axios.delete(`${baseURL}/flight/${flightid}`, {
                    headers: {
                        "Authorization": "Bearer " + token
                    }
                })
                    .then((response) => {
                        window.location.reload()
                    })

                    .catch((error) => {
                        console.log(error.response.data)
                    })
            })

            // When delete promotion form is submitted
            $("#delete-promotion-form").submit((event) => {
                // Prevent page from loading
                event.preventDefault()

                // Get promotionid to delete
                const promotionid = $("#promotion-options").val()

                // Axios DELETE method to delete a promotion by promotionid
                axios.delete(`${baseURL}/promotion/${promotionid}`, {
                    headers: {
                        "Authorization": "Bearer " + token
                    }
                })
                    .then((response) => {
                        window.location.reload()
                    })

                    .catch((error) => {
                        console.log(error.response.data)
                    })
            })
        </script>

        <!-- Append Table Contents -->
        <script>
            // GET user information
            axios.get(`${baseURL}/users/`, {
                headers: {
                    "Authorization": "Bearer " + token
                }
            })
                .then((response) => {
                    const userList = response.data
                    if (userList.length > 0) {                        
                        userList.forEach((user) => {
                            const tableRow = `
                            <tr>
                                <th><img src="${user.profile_pic_url}" width=60px height=60px class="rounded-circle border border-dark" style="object-fit:cover;"></th>
                                <th>${user.username}</th>
                                <th>${user.email}</th>
                                <th>${user.contact}</th>
                                <th>${user.role}</th>
                                <th>${user.created_at}</th>
                            </tr>
                            `
                            $("#user-table-body").append(tableRow)
                        })
                    }
                })

                .catch((error) => {
                    console.log(error.response.data)
                })

            // GET airport information
            axios.get(`${baseURL}/airport/`, {
                headers: {
                    "Authorization": "Bearer " + token
                }
            })
                .then((response) => {
                    const airportList = response.data
                    if (airportList.length > 0) {
                        airportList.forEach((airport, index) => {
                            const tableRow = `
                            <tr>
                                <th>${(index+1)}</th>
                                <th>${airport.name}</th>
                                <th>${airport.country}</th>
                                <th>${airport.description}</th>
                                <th>${airport.iata}</th>
                            </tr>
                            `
                            $("#airport-table-body").append(tableRow)
                        })
                    }
                })

                .catch((error) => {
                    console.log(error.response.data)
                })

            // GET flight information
            axios.get(`${baseURL}/flight`)
                .then((response) => {
                    // Get all flight information
                    const flightList = response.data
                    if (flightList.length > 0) {
                        flightList.forEach((flight, index) => {
                            const tableRow = `
                            <tr>
                                <th>${(index+1)}</th>
                                <th>${flight.flightCode}</th>
                                <th>${flight.aircraft}</th>
                                <th>${flight.originAirport1}</th>
                                <th>${flight.originAirportIata}</th>
                                <th>${flight.destinationAirport1}</th>
                                <th>${flight.destinationAirportIata}</th>
                                <th>${flight.embarkDate}</th>
                                <th>${flight.travelTime}</th>
                                <th>${flight.price}</th>
                                <th><a class="btn btn-primary" href="${flight.flight_pic_url}" target="__blank" style="padding:0px;">View Image</a></th>
                                <th>${flight.created_at}</th>
                                <th><a href="/flightdetails" class="btn btn-primary p-0" onclick="flightRedirect(${flight.flightid})">View Flight</a></th>
                            </tr>
                            `
                            $("#flight-table-body").append(tableRow)
                        })   
                    }
                })

                .catch((error) => {
                    if (error.response.status === 422) {
                        alert("Flight code already exists! Please enter a unique flight code.")
                    }
                    console.log(error.response.data)
                })

            // GET promotion information
            axios.get(`${baseURL}/promotion`)
                .then((response) =>{
                    // Get all promotion information
                    const promotionList = response.data
                    if (promotionList.length > 0) {
                        promotionList.forEach((promotion, index) => {
                            const tableRow = `
                            <tr>
                                <th>${index+1}</th>
                                <th>${promotion.flight}</th>
                                <th>${promotion.startDate}</th>
                                <th>${promotion.endDate}</th>
                                <th>${(promotion.discount)*100}</th>
                            </tr>
                            `
                            $("#promotion-table-body").append(tableRow)
                        })
                    }
                })

        </script>

        <!-- Append Select Options -->
        <script>
            // Axios GET method to get airport options
            axios.get(`${baseURL}/airport`)
                .then((response) => {
                    const airportList = response.data
                    if (airportList.length > 0) {
                        airportList.forEach((airport) => {
                            optionsHTML = `
                            <option value=${airport.airportid}>${airport.name}</option>
                            `
                            $("#airport-options-1").append(optionsHTML)
                            $("#airport-options-2").append(optionsHTML)
                            $("#airport-options-3").append(optionsHTML)
                        })
                    }
                })

                .catch((error) => {
                    console.log(error.response.data)
                })
            
            // Axios GET method to get flight options
            axios.get(`${baseURL}/flight`)
                .then((response) => {
                    const flightList = response.data
                    if (flightList.length > 0) {
                        flightList.forEach((flight) => {
                            optionsHTML = `
                            <option value=${flight.flightid}>${flight.flightCode} (${flight.originAirportIata} - ${flight.destinationAirportIata})</option>
                            `
                            $("#promotion-flight").append(optionsHTML)
                            $("#flight-options").append(optionsHTML)
                            
                        })

                    // Axios GET method to get promotion options
                    axios.get(`${baseURL}/promotion`)
                        .then((response) => {
                            const promotionList = response.data
                            if (promotionList.length > 0) {
                                promotionList.forEach((promotion, index) => {
                                    optionsHTML = `
                                    <option value="${promotion.promotionid}">Promotion for ${flightList[index].flightCode} (${flightList[index].originAirportIata} - ${flightList[index].destinationAirportIata})</option>
                                    `
                                    $("#promotion-options").append(optionsHTML)
                                })
                            }
                        })
                    }
                })

                .catch((error) => {
                    console.log(error.response.data)
                })
        </script>
    </body>
</html>